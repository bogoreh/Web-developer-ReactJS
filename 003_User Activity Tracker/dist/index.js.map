{"version":3,"file":"index.js","sources":["../src/events.tsx","../src/storage.tsx","../src/index.tsx"],"sourcesContent":["//Basic user activity tracking\r\nconst INPUT_EVENT_NAMES: string[] = [\"click\", \"mousemove\", \"keydown\"];\r\n\r\nexport const addTrackingEventListeners = (onEventFunction: Function) => {\r\n  INPUT_EVENT_NAMES.forEach((eventName) =>\r\n    document.body.addEventListener(eventName, (e) => onEventFunction(e), false)\r\n  );\r\n  window.addEventListener(\r\n    \"blur\",\r\n    (e) => {\r\n      onEventFunction(e);\r\n    },\r\n    false\r\n  );\r\n  window.addEventListener(\r\n    \"focus\",\r\n    (e) => {\r\n      onEventFunction(e);\r\n    },\r\n    false\r\n  );\r\n};\r\nexport const removeTrackingEventListeners = (onEventFunction: Function) => {\r\n  INPUT_EVENT_NAMES.forEach((eventName) =>\r\n    document.body.removeEventListener(eventName, () => onEventFunction(), false)\r\n  );\r\n  window.removeEventListener(\r\n    \"blur\",\r\n    (e) => {\r\n      onEventFunction(e);\r\n    },\r\n    false\r\n  );\r\n  window.removeEventListener(\r\n    \"focus\",\r\n    (e) => {\r\n      onEventFunction(e);\r\n    },\r\n    false\r\n  );\r\n};\r\n","const STORAGE_ID = \"trackerIdValue\";\r\nexport const setStorage = (trackerId: number) => {\r\n  sessionStorage.setItem(STORAGE_ID, trackerId.toString());\r\n};\r\nexport const getStorage = () => {\r\n  return sessionStorage.getItem(STORAGE_ID);\r\n};\r\n","import * as React from \"react\";\r\nconst { useState, useEffect } = React;\r\nimport {\r\n  addTrackingEventListeners,\r\n  removeTrackingEventListeners\r\n} from \"./events\";\r\nimport { getStorage, setStorage } from \"./storage\";\r\n\r\nexport type IActivityTrackerProps = {\r\n  trackerId: number;\r\n  timeout: number;\r\n  trackerSubmitInterval: number;\r\n  onTrackerIdChange: Function;\r\n  onIntervalSubmit: Function;\r\n  debugOn: boolean;\r\n};\r\n\r\nconst App: React.FC<IActivityTrackerProps> = ({\r\n  trackerId,\r\n  onTrackerIdChange,\r\n  timeout,\r\n  trackerSubmitInterval,\r\n  onIntervalSubmit,\r\n  debugOn,\r\n}) => {\r\n  const [timer, setTimer] = useState(0);\r\n  const [countdown, setCountdown] = useState(timeout || 30 * 60);\r\n  const [timedOut, setTimedOut] = useState(false);\r\n\r\n  const onUserActivity = (e:Event) => {\r\n    if ( e.type && e.type === 'blur') { setCountdown(0); return; } //window on blur\r\n    setCountdown(timeout || 30 * 60);\r\n  };\r\n\r\n  useEffect(() => {\r\n    addTrackingEventListeners(onUserActivity);\r\n    return () => {\r\n      removeTrackingEventListeners(onUserActivity);\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (countdown === 0) {\r\n      setTimedOut(true);\r\n    } else {\r\n      setTimedOut(false);\r\n    }\r\n  }, [countdown]);\r\n\r\n  useEffect(() => {\r\n    //fire onTrackChange if timer > 0\r\n    if (timer > 0)\r\n      onTrackerIdChange(getStorage() ? getStorage() : trackerId, timer);\r\n\r\n    //Reset timer\r\n    setTimer(0);\r\n\r\n    //start timer if not timed out\r\n    let interval: number;\r\n    if (!timedOut) {\r\n      interval = setInterval(() => {\r\n        setTimer((prevValue) => prevValue + 1);\r\n        setCountdown((prevValue) => prevValue - 1);\r\n      }, 1000);\r\n    }\r\n\r\n    //set new tracker to storage\r\n    setStorage(trackerId);\r\n\r\n    return () => {\r\n      clearInterval(interval);\r\n    };\r\n  }, [trackerId, timedOut]);\r\n\r\n  //submit change every x second\r\n  useEffect(() => {\r\n    if( timer >= trackerSubmitInterval && trackerSubmitInterval && onIntervalSubmit ) {\r\n      onIntervalSubmit(trackerId, timer);\r\n      setTimer(0);\r\n    }\r\n  }, [timer])\r\n\r\n  return (\r\n    <div\r\n      style={{\r\n        position: \"fixed\",\r\n        zIndex: 999,\r\n        bottom: 20,\r\n        right: 20,\r\n        padding: 20,\r\n        backgroundColor: \"grey\",\r\n        display: debugOn ? \"block\" : \"none\",\r\n      }}\r\n    >\r\n      <p>tracker : {trackerId}</p>\r\n      <p>countdown to timeout : {countdown}</p>\r\n      <p>timer : {timer}</p>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default App;\r\n"],"names":["React"],"mappings":"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"}